<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<link rel="stylesheet" href="../css/theme-default-easytable.css" />
		<script src="../js/config.js"></script>
		<script src="../js/Sortable.js"></script>
		<script src="https://unpkg.com/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	</head>
	<body>
		<div id="app" style="font-size: 12px;">
			<div class="ve-table">
				<div class="ve-table-container ve-table-border-around" id="vDiv" style="max-height: 864px; ">
					<table class="ve-table-content ve-table-border-x ve-table-border-y" id="vTable" style="width: 2000px;">
						<thead class="ve-table-fixed-header ve-table-header">
							<tr class="ve-table-header-tr">
								<th class="ve-table-fixed-left" style="width: 15px; left: 0px;background-color: #fafafa;"></th> 
								<th class="ve-table-header-th ve-table-fixed-left" style="width: 90px; left: 15px;">股票</th>
								<th class="ve-table-header-th" style="width: 90px;"><a id="sshy" @click="doSort">行业</a></th>
								<th class="ve-table-header-th" style="width: 90px;">基金持股</th>
								<th class="ve-table-header-th" style="width: 90px;"><a id="ggyb.count" @click="doSort"> 个股研报 </a></th>
								<th class="ve-table-header-th" style="width: 80px;"><a id="sylj" @click="doSort"> PE(静) </a><b class="hxsjccsyl" :title="sylj_title" /></th>
								<th class="ve-table-header-th" style="width: 80px;white-space: nowrap;"><a id="sygd" @click="doSort"> PE TTM</a><b class="hxsjccsyl" :title="sygd_title" /></th>
								<th class="ve-table-header-th" style="width: 80px;"><a id="syld" @click="doSort"> PE(动) </a><b class="hxsjccsyl" :title="syld_title" /></th>
								<th class="ve-table-header-th" style="width: 80px;"><a id="sjl" @click="doSort"> 市净率 </a><b class="hxsjccsyl"	 :title="sjl_title" /></th>
								<th class="ve-table-header-th" style="width: 80px;"><a id="jzcsyl" @click="doSort"> ROE </a><b class="hxsjccsyl" :title="jzcsyl_title" /></th>
								<th class="ve-table-header-th" style="width: 70px;"><a id="fzl" @click="doSort"> 负债率 </a></th>
								<th class="ve-table-header-th" style="width: 70px;"><a id="mll" @click="doSort"> 毛利率 </a></th>
								<th class="ve-table-header-th" style="width: 70px;"><a id="jll" @click="doSort"> 净利率 </a></th>
								<th class="ve-table-header-th" style="width: 70px;"><a id="days" @click="doSort"> 连涨天数 </a></th>
								<th class="ve-table-header-th" style="width: 240px;" v-for="d in dates"><a :id="d+'.zdf'" @click="doSort"> {{d}}</a><b class="hxsjccsyl" :title="hs_lb_title" /> </th>
								<th class="ve-table-header-th" style="width: 100px;">总市值</th>
								<th class="ve-table-header-th" style="width: 100px;">流通市值</th>
								<th class="ve-table-header-th" style="width: 100px;">季度收益</th>
								<th class="ve-table-header-th" style="width: 150px;"><a id="jlrtb" @click="doSort"> 净利润|同比 </a></th>
								<th class="ve-table-header-th" style="width: 150px;"><a id="zystb" @click="doSort"> 总营收|同比 </a></th>
								<th class="ve-table-header-th" style="width: 80px;"><a id="mgwfplr" @click="doSort"> 每股未分配利润 </a><b class="hxsjccsyl"
									 :title="mgwfplr_title" /></th>
								<th class="ve-table-header-th" style="width: 80px;"><a id="mgjzc" @click="doSort"> 每股净资产 </a><b class="hxsjccsyl"
									 :title="mgjzc_title" /></th>
							</tr>
						</thead>
						<tbody id="sort" class="ve-table-body ve-table-stripe ve-table-row-hover ve-table-row-highlight">
							<tr style="height: 0px;"></tr>
							<tr class="ve-table-body-tr" v-for="col in tableData" :id="col.scode">
								<td class="ve-table-fixed-left" style="text-align: right;left: 0px;">
									<a href="#" class="em-totop" @click="moveTop(col.scode)"><b class="em-icon em-ftop em-pro-toTop"></b></a>
								</td>
								<td class="ve-table-body-td ve-table-fixed-left" style="text-align: left;left: 15px;" :title="col.info">
									<a :href="col.market=='HK' ? 'http://quote.eastmoney.com/hk/'+col.scode+'.html' : 'http://quote.eastmoney.com/'+col.market+col.scode+'.html'"
									 target="_blank">
										{{col.sname}}<br>
										<font style="color: #888">{{col.market}}.{{col.scode}}</font>
									</a>
								</td>
								<td class="ve-table-body-td" style="text-align: center;">{{col.sshy}}</td>
								<td class="ve-table-body-td" style="text-align: left;color: #4372ba;">
									<div v-on:click="showFundDetail(col.scode)">
										{{col.ccl? col.ccl+'万股':''}}<br>{{col.cgjs? col.cgjs+'家':''}}<br>{{col.ltbl? '占'+col.ltbl+'%':''}}
									</div>
								</td>
								<td class="ve-table-body-td" style="text-align: left;padding-left: 10px;">
									<div v-if="col.ggyb!=null" v-on:click="showReportStock(col.scode)">
										近一月<b style="color: blue;">{{col.ggyb.count}}</b>次<br>
										评级: {{col.ggyb.emRatingName}}<br>
										<font style="color: #888">{{col.ggyb.publishDate}}</font>
									</div>
								</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.sylj}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.sygd}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.syld}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.sjl}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.jzcsyl}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.fzl}}%</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.mll}}%</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.jll}}%</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 35px;">
									<span :style="col.days>0 ? 'color: red' : 'color: green'">{{col.days}}</span>
								</td>
								<td class="ve-table-body-td" style="text-align: left;padding-left: 10px;" v-for="d in dates">
									<div v-if="col[d]!=null" style="white-space: nowrap;">
										<ul style="list-style: none;display: inline-block;width: 30px;">
											<li>涨幅：</li>
											<li>最新：</li>
											<li>换手：</li>
											<li>量比：</li>
										</ul>
										<ul style="list-style: none;display: inline-block;width: 50px;">
											<a v-if="col.market!='HK'" :href="'http://quote.eastmoney.com/concept/'+col.market+col.scode+'.html'" target="_blank">
												<li><span :style="col[d]['zdf']>0 ? 'color: red' : 'color: green'">{{col[d]['zdf']}}%</span></li>
												<li><span :style="col[d]['zdf']>0 ? 'color: red' : 'color: green'">{{col[d]['zxj']}}</span></li>
												<li><span style="color: black">{{col[d]['hs']}}%</span></li>
												<li><span :style="col[d]['lb']>1.5 ? 'color: red' : 'color: black'">{{col[d]['lb']}}</span></li>
											</a>
											<a v-else :href="'http://data.eastmoney.com/hsgtcg/StockHdStatistics.aspx?stock='+col.scode" target="_blank">
												<li><span :style="col[d]['zdf']>0 ? 'color: red' : 'color: green'">{{col[d]['zdf']}}%</span></li>
												<li><span :style="col[d]['zdf']>0 ? 'color: red' : 'color: green'">{{col[d]['zxj']}}</span></li>
												<li><span style="color: black">{{col[d]['hs']}}%</span></li>
												<li><span :style="col[d]['lb']>1.5 ? 'color: red' : 'color: black'">{{col[d]['lb']}}</span></li>
											</a>
										</ul>
										<ul style="list-style: none;display: inline-block;width: 53px;">
											<li>主力净入：</li>
											<li>主力净比：</li>
											<li>总成交额：</li>
											<li v-if="col.market!='HK'">北向净入：</li>
											<li v-else><span style="color: white">.</span></li>
										</ul>
										<ul style="list-style: none;display: inline-block;">
											<a :href="col.market=='HK' ? 'http://data.eastmoney.com/hsgtcg/StockHdDetail.aspx?stock='+col.scode : 'http://data.eastmoney.com/zjlx/'+col.scode+'.html'"
											 target="_blank">
												<li><span :style="col[d]['zljb']>0 ? 'color: red' : 'color: green'">{{col[d]['zljll']}}</span></li>
												<li><span :style="col[d]['zljb']>0 ? 'color: red' : 'color: green'">{{col[d]['zljb']}}%</span></li>
												<li><span style="color: black">{{col[d]['cje']}}</span></li>
											</a>
											<li v-if="col[d]['zcsz']==''"><span style="color: white">.</span></li>
											<li v-else-if="col.market!='HK'">
												<a :href="'http://data.eastmoney.com/hsgtcg/StockHdDetail.aspx?stock='+col.scode" target="_blank">
													<span :style="col[d]['zcszzf']>0 ? 'color: red' : 'color: green'">{{col[d]['zcsz']}}</span>
												</a>
											</li>
										</ul>
									</div>
								</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 10px;">{{col.zsz}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 10px;">{{col.ltsz}}</td>
								<td class="ve-table-body-td" style="text-align: right;"><span :style="col.jdsy>0 ? 'color: red' : 'color: green'">{{col.jdsy}}%</span>&nbsp;({{col.jd}})</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 10px;">{{col.jlr}} <span :style="col.jlrtb>0 ? 'color: red' : 'color: green'">{{col.jlrtb?'| '+col.jlrtb+'%':''}}</span></td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 10px;">{{col.zys}} | <span :style="col.zystb>0 ? 'color: red' : 'color: green'">{{col.zystb}}%</span></td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 20px;">{{col.mgwfplr}}</td>
								<td class="ve-table-body-td" style="text-align: right;padding-right: 10px;">{{col.mgjzc}}</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<!--弹出层时背景层DIV-->
		<div id="fade" class="black_overlay" onclick="CloseDiv()"></div>
		<div id="MyDiv" class="white_content" style="overflow-x:hidden; overflow-y:hidden;"></div>
	</body>

	<script>
		var fcode = "all";
		var h = location.href;
		if (h.indexOf("?") > 0) {
			fcode = h.substr(h.indexOf("?") + 1);
			console.log(fcode);
			document.getElementById('vDiv').style.maxHeight = '680px';
			document.getElementById('vTable').style.maxHeight = '655px';
		}
		var fade = document.getElementById('fade');
		var MyDiv = document.getElementById('MyDiv');
		//关闭弹出层
		fade.onclick = function() {
			MyDiv.style.display = 'none';
			fade.style.display = 'none';
		};
		// 异步请求函数必须要写在外面，然后在vue里面调用
		function asyncLoadDate() {
			axios.get(url + 'stock/' + fcode)
				.then(function(response) {
					if (response.status == 200) {
						vm.fillData(response);
					}
				})
				.catch(function(error) {
					alert("系统异常");
				});
		}

		function refleshStockMoneyFlow() {
			axios.get(url + 'refleshStockMoneyFlow')
				.then(function(response) {
					if (response.status == 200) {
						asyncLoadDate();
					}
				})
				.catch(function(error) {
					alert("系统异常");
				});
		}
		var vm = new Vue({
			el: "#app",
			mounted: function() {
				asyncLoadDate();
				saveSortData('sort', url + 'setStockSort');
			},
			methods: {
				//弹出隐藏层
				getJsonValue: function(json) {
					console.log(json)
				},
				showFundDetail: function(scode) {
					if (fcode == "all") {
						MyDiv.style.left = '20%';
					} else {
						MyDiv.style.left = '13%';
						MyDiv.style.top = '0';
					}
					MyDiv.style.width = '1150px';
					MyDiv.style.height = '680px';
					MyDiv.style.display = 'block';
					fade.style.display = 'block';
					MyDiv.innerHTML = '<object type="text/html" data="fundDetail.html?' + scode +
						'" width="100%" height="99%"></object>';

				},
				showReportStock: function(scode) {
					if (fcode == "all") {
						MyDiv.style.left = '20%';
					} else {
						MyDiv.style.left = '13%';
						MyDiv.style.top = '0';
					}
					MyDiv.style.width = '1150px';
					MyDiv.style.height = '680px';
					MyDiv.style.display = 'block';
					fade.style.display = 'block';
					MyDiv.innerHTML = '<object type="text/html" data="reportStock.html?' + scode +
						'" width="100%" height="100%"></object>';

				},
				fillData: function(response) {
					let json = response.data;
					this.tableData = json.data;
					this.dates = json.columns;
					// console.log(JSON.stringify(this.tableData))
				},
				moveTop: function(id){ 
					moveTop(id, 'sort', url + 'setStockSort');
				},				
				doSort: function(event) {
					if(this.isDragging){
						destroySort();
						this.isDragging = false;
					}
					// console.log(event.target.className)
					// console.log(event.target.id)
					var className = event.target.className;
					className = className == '' || className == 'asc' ? 'desc' : 'asc';
					document.querySelectorAll('.desc').forEach(a => {
						a.className = ''
					})
					document.querySelectorAll('.asc').forEach(a => {
						a.className = ''
					})
					event.target.className = className;
					let data = this.tableData.slice(0);
					var id = event.target.id;
					var hasSub = id.indexOf(".") > 0;
					if (hasSub) {
						var i = id.indexOf(".");
						id_o = id.substr(0, i);
						id_t = id.substr(i + 1);
					}
					if (className === "asc") {
						data.sort((a, b) => {
							if (hasSub) {
								if (a[id_o] == null || a[id_o][id_t] == null || a[id_o][id_t] == '')
									return 1;
								if (b[id_o] == null || b[id_o][id_t] == null || b[id_o][id_t] == '')
									return -1; 
								re = a[id_o][id_t] - b[id_o][id_t];
								return isNaN(re) ? a[id_o][id_t].localeCompare(b[id_o][id_t]) : re;
							} else {
								if (a[id] == null || a[id]=='') 
									return 1; 
								if (b[id] == null || b[id]=='')
									return -1; 
								re = a[id] - b[id];
								return isNaN(re) ? a[id].localeCompare(b[id]) : re;
							}
						});
					} else if (className === "desc") {
						data.sort((a, b) => {
							if (hasSub) {
								if (a[id_o] == null || a[id_o][id_t] == null || a[id_o][id_t] == '')
									return 1;
								if (b[id_o] == null || b[id_o][id_t] == null || b[id_o][id_t] == '')
									return -1; 
								re = b[id_o][id_t] - a[id_o][id_t];
								return isNaN(re) ? b[id_o][id_t].localeCompare(a[id_o][id_t]) : re;
							} else {
								if (a[id] == null || a[id]=='') 
									return 1; 
								if (b[id] == null || b[id]=='')
									return -1;
								re = b[id] - a[id];
								return isNaN(re) ? b[id].localeCompare(a[id]) : re;
								
							}
						});
					}

					this.tableData = data;
				}
			},
			data: function() {
				return {
					isDragging : true,
					hs_lb_title: '换手率=（某一段时期内的成交量）/（流通股）x 100% ，反映股票流通性强弱的指标之一\n' +
						'将换手率与股价走势相结合，可以股价做出一定的预测和判断。某只股票的换手率突然上升，成交量放大，可能意味着有投资者在大量买进，\n' +
						'股价可能会随之上扬。如果某只股票持续上涨了一个时期后，换手率又迅速上升，则可能意昧着一些获利者要套现，股价可能会下跌\n\n' +
						'量比=（现成交总手数 / 现累计开市时间(分) ）/ 过去5日平均每分钟成交量，衡量相对成交量的指标。\n' +
						'量比的数值越大，表明了该股当日流入的资金越多，市场活跃度越高；反之，量比值越小，说明了资金的流入越少，市场活跃度越低\n' +
						'0.8-1.5倍 正常水平\n' +
						'1.5-2.5倍 温和放量，如股价也处于温和缓升状态，则升势相对健康，可继续持股，如股价下跌，则可认定跌势难以在短期内结束，考虑停损退出\n' +
						'2.5-5  倍 明显放量，如股价相应地突破重要支撑或阻力位置，则突破有效的几率颇高，可以相应地采取行动\n' +
						'5-10   倍 剧烈放量，如个股处于长期低位出现剧烈放量突破，涨势的后续空间巨大；如个股已有巨大涨幅的情况下出现剧烈的放量，值得高度警惕\n' +
						'10倍以上 一般可以考虑反向操作，在涨势中出现这种情形，说明见顶的可能性压倒一切；阴跌的后期，突然巨大量比，说明彻底释放了下跌动能\n' +
						'20倍以上 是极端放量，如连续的上涨后，但股价出现“滞涨”现象，则涨势死亡信号；如股票在跌势中极端放量，则建仓的大好时机',
					sylj_title: '静态市盈率=总市值/净利润，股票是否被高估或者低估的指标。股票必须属于同一个行业，每股收益比较接近，相互比较才有效。',
					sygd_title: '滚动市盈率=总市值/过去四个季度净利润之和，更加准确，数据更新',
					syld_title: '动态市盈率=总市值/预估净利润, 通常作为股票是便宜抑或昂贵的指标，动态市盈率小于静态市盈率说明这个股票的成长性好',
					sjl_title: '市净率＝股价／每股净资产，一般来说市净率较低的股票，投资价值较高。在熊市投资者们乐于使用市净率指标，更能体现股票的安全边际',
					jzcsyl_title: '净资产收益率=税后利润 / 所有者权益。衡量企业盈利能力，越高收益越多，说明公司对资本金的利用与管理越有效',
					mgjzc_title: '每股净资产= 股东权益总额 / 股本总股数。反映每股股票所拥有的资产现值。每股净资产越高，股东拥有的每股资产价值越多；越高越好',
					mgwfplr_title: '每股未分配利润=企业当期未分配利润总额/总股本，未分配利润是企业留待以后年度进行分配的结存利润，若为负数则为尚未弥补的亏损\n' +
						'未分配利润有两个方面的含义：一是留待以后年度分配的利润；二是尚未指定特定用途的利润',
					dates: [],
					tableData: []
				};
			},
		});
	</script>

</html>
